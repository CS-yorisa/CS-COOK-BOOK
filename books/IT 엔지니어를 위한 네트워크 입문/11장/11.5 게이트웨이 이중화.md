[TOC]

# 11.5 게이트웨이 이중화

- 특정 호스트가 **동일한 서브넷에 있는 내부 네트워크**와 통신할 때는 ARP 를 직접 브로드캐스트
  - 3계층 장비인 라우터의 도움 없이 <u>출발지와 목적지가 직접 통신</u> (L2 통신)

- 목적지가 출발지 호스트의 서브넷에 포함되지 않은 경우, **게이트웨이**를 통해 통신 (L3 통신)

![image](https://user-images.githubusercontent.com/87461594/195327746-544a4c6f-f549-488c-9e18-f57d51d5a4de.png)

- 게이트웨이가 두 대로 이중화 되어 있음에도 불구하고 <u>경로를 사용할 수 없어 통신이 두절됨</u>

> **FHRP (First Hop Redundancy Protocol) 프로토콜**을 통해 게이트웨이를 이중화 할 수 있음

<br>

## 11.5.1 FHRP

> 외부 네트워크와 통신하기 위해 사용되는 게이트웨이 장비 두 대 이상으로 구성할 수 있는 프로토콜

- FHRP 그룹 내의 장비가 **동일한 가상 IP**를 갖도록 설정하고 <u>Active 에 대한 우선순위</u> 설정

![image](https://user-images.githubusercontent.com/87461594/195330892-dbeb2688-4cd9-4f6f-83d7-ff9ead0b16fc.png)

- 액티브 장비에 장애가 발생하면 스탠바이 장비가 **가상 IP 주소에 대한 액티브 역할**을 가져옴
  - MAC 주소 테이블을 갱신해 하단 호스트들은 <u>자동으로 절체가 이루어짐</u>
  - 게이트웨이에 대한 정보 변경이나 별도의 작업 없이 페일오버를 수행해 **서비스 연속성 확보**

![image](https://user-images.githubusercontent.com/87461594/195334808-3da6b97b-6a06-4d2d-a737-6b0cc8505d88.png)

- 게이트웨이에서 <u>외부로 나가는 경로가 다운된 경우</u>에도 감지해서 절체가 이루어짐

![image](https://user-images.githubusercontent.com/87461594/195334978-feeb0d5b-564b-4a50-85ba-69b7d7217ce3.png)

<br>

## 11.5.2 올 액티브 게이트웨이 이중화

> MC-LAG 기술을 사용할 때 게이트웨이를 액티브-액티브 형태로 구성하여 트래픽 우회 방지

- STP 구조에서 게이트웨이 외부로 가기 위한 경로가 스탠바이더라도 **액티브 장비를 통해서 외부로 나감**

![image](https://user-images.githubusercontent.com/87461594/195337571-3e074121-7841-4796-becd-9770ac12df2b.png)

- MC-LAG을 이용해 일반적인 게이트웨이 이중화를 구성할 때도 액티브 장비를 통하게 되어 **트래픽 우회 발생**

![image](https://user-images.githubusercontent.com/87461594/195338400-b986b120-537c-4f13-829e-9c51912a28b7.png)

- 이중화를 **액티브-액티브 형태**로 구성하여 트래픽 우회 방지

![image](https://user-images.githubusercontent.com/87461594/195338573-c5dcd27c-ea0f-48ae-8535-ce28330f972a.png)

<br>

## 11.5.3 애니캐스트 게이트웨이

> 애니캐스트를 사용하여 **같은 네트워크가 여러 위치에 존재**하게 네트워크를 디자인

- 여러 개의 같은 IP를 가진 게이트웨이 중 **가장 가까운 위치에 있는 게이트웨이**에서 서비스 제공
- 하나의 게이트웨이에 문제가 발생해도 랙 하나에서만 장애가 발생 (다른 위치에서는 통신에 문제 없음)

![image](https://user-images.githubusercontent.com/87461594/195344953-b37828bc-c3a8-4555-a9fd-2c579e8cb75d.png)

- **액티브-액티브** 게이트웨이와 **애니캐스트** 게이트웨이를 함께 사용하기도 함