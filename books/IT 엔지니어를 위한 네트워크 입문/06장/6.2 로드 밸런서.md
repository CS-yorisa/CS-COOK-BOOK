[TOC]

# 6.2 로드 밸런서

> 서버나 장비의 부하를 **분산**하기 위해 사용하는 장비 (**트래픽**을 분배)

- **4계층 이상**에서 동작하며 IP 주소나 4계층 정보, 애플리케이션 정보를 <u>확인, 수정</u>하는 기능

- 대표 IP 주소를 가진 로드 밸런서가 각 시스템의 실제 IP로 변경해 요청

  > 작은 장비 여러 대를 묶어 사용하는 **'스케일 아웃'** 방법에서 활용

  - 작은 시스템 여러 대를 서버 배치와 상관없이 <u>하나의 서비스</u>로 보이게 만들 수 있음

  ![image](https://user-images.githubusercontent.com/87461594/183282396-d821a031-af73-4820-93b9-c027a49773a9.png)

## 계층에 따른 분류

### 4계층 : L4 로드 밸런싱

> 일반적인 로드 밸런서가 동작하는 방식

- **TCP, UDP 정보(특히 포트 넘버)**를 기반으로 로드 밸런싱을 수행

- 최근 로드 밸런서는 L4, L7의 기능을 모두 지원 (L4 전용 장비는 찾기 힘듬)

  > 데이터 센터의 로드 밸런서 장비는 L4, L7 모두 지원하며 설정에 따라 L4, L7 로드 밸런싱으로 나뉨

### 7계층 : L7 로드 밸런싱

- **HTTP, FTP, SMTP**와 같은 애플리케이션 프로토콜 정보를 기반으로 로드 밸런싱 수행

- **HTTP 헤더 정보**나 **URI**와 같은 정보를 기반으로 프로토콜 이해 후 <u>부하를 분산</u>

  > 일반적으로 이런 장비를 **ADC(Application Delivery Controller)**라고 부르며 **프록시(Proxy)** 역할 수행

- 스퀴드(Squid)나 Nginx에서 수행하는 **리버스 프록시**와 유사한 기능을 가짐

<br>

## 6.2.1 L4 스위치

> 4계층에서 동작하면서 로드 밸런서 기능이 있는 스위치

- 내부 동작 방식은 4계층 로드 밸런서이지만 외형은 스위치처럼 **여러 개의 포트**를 가짐

- **부하 분산, 성능 최적화, 리다이렉션** 기능을 제공

  ![image](https://user-images.githubusercontent.com/87461594/183283614-dd5fe9df-c9d9-45f8-b899-62a10a6cb7f4.png)

- L4 스위치가 동작하려면 **가상 서버, 가상 IP, 리얼 서버와 리얼 IP**를 설정해야 함

  - **가상 서버 :** 사용자가 바라보는 실제 서비스
  - **가상 IP :** 사용자가 접근해야 하는 서비스 IP 주소
  - **리얼 서버 :** 실제 서비스를 수행하는 서버
  - **리얼 IP :** 실제 서버의 IP

  > L4 스위치의 가상 IP를 목적지로 서비스를 요청하고 목적지로 설정된 **가상 IP를 리얼 IP로 다시 변경**

<br>

## 6.2.2 ADC

> Application Delivery Controller, **애플리케이션 계층**에서 동작하는 로드 밸런서

- 프로토콜의 헤더와 내용을 이해하고 동작하므로 **다양한 부하 분산, 정보 수정, 정보 필터링**이 가능

- 일부 ADC를 제외한 대부분의 ADC는 <u>L4 스위치의 기능을 포함</u>

  > 4계층에서 애플리케이션 계층까지 로드 밸런싱 기능을 제공하고 **페일오버, 리다이렉션** 기능도 함께 수행

  > 페일오버 (failover) : 네트워크 등에서 이상이 생겼을 때 예비 시스템으로 자동전환되는 기능

- **캐싱, 압축, 콘텐츠 변환 및 재작성, 인코딩 변환** 등이 가능

- 애플리케이션 프로토콜 **최적화** 기능도 제공

- 플러그인 형태로 보안 강화 기능을 추가로 제공해 **WAF** 기능이나 **HTML, XML 검증과 변환**을 수행

  > WAF (Web Application Firewall) : 웹 애플리케이션 보안에 특화되어 개발된 방화벽

<br>

## 6.2.3 L4 스위치 vs ADC

