# 3.3 IP 주소 (2)

## 클래스풀과 클래스리스

- 클래스 기반의 IP 주소 체계를 클래스풀(Classful)이라고 함
- 클래스풀에서는 구분자(서브넷 마스크) 없이 맨 앞자리 숫자로 어느 클래스인지 구분 가능



## 클래스리스 네트워크

- 상위 클래스(A class)를 할당받은 조직에서 IP를 제대로 사용 하지 못 하여 낭비되는 IP가 많음
  - 한 개의 클래스 네트워크가 한 조직에 할당되면 아무리 비어 있어도 IP 주소를 분할해 다른 기관이 사용할 수 없음

- IP 주소 부족과 낭비 문제를 해결하기 위한 3가지 보존, 전환 전략
  - ① 클래스리스 ② CIDR 기반의 주소체계 ③ IPv6
- 네트워크와 호스트 주소를 나누는 **서브넷* 마스크가 반드시 필요함**

> 서브넷 : IP 주소에서 네트워크 영역을 부분적으로 나눈 부분 네트워크
> 서브넷 마스크 : 이러한 서브넷을 만들 때 사용되는 것이 서브넷 마스크



### 서브넷 마스크

#### A 클래스

| 네트워크 | 호스트 | 호스트 | 호스트 |
| :------: | :----: | :----: | :----: |
|   255    |   0    |   0    |   0    |

#### B 클래스
   | 네트워크 | 네트워크 | 호스트 | 호스트 |
   | :------: | :------: | :----: | :----: |
   |   255    |   255    |   0    |   0    |

#### C 클래스

| 네트워크 | 네트워크 | 네트워크 | 호스트 |
| :------: | :------: | :------: | :----: |
|   255    |   255    |   255    |   0    |

- 103.9.32.146 주소에 255.255.255.0 서브넷 마스크를 사용하면, AND 연산을 통해 네트워크 주소가 103.9.32.0 이고 호스트 주소가 0.0.0.146 이 됨
- 비트 단위로 표현하면 A 클래스는 /8, B 클래스는 /16, C클래스는 /24



## 서브네팅(Subnetting)

- 원래 기준을 무시하고 새로운 네트워크-호스트 구분 기준을 사용자가 정해 원래 클래스풀 단위보다 더 쪼개 사용하는 것
- 디폴트 서브넷 마스크를 기준으로 해서 네트워크 ID 비트 수를 늘리고, 호스트 ID 비트 수를 줄임
- 이때 기준에서 늘어난 네트워크 ID 비트를 서브넷 ID라고 부름
- 한 비트씩 서브넷 마스크에 추가할 때마다 네트워크의 크기는 2배 증가하고, 할당할 수 있는 호스트의 수는 2로 나눠지게 됨



### 네트워크 사용자의 서브네팅

- 네트워크에서 사용할 수 있는 IP 주소 범위 파악
  - 대부분의 서브네팅은 비트 단위로 분할되므로 제대로 파악해야 함
- 기본 게이트웨이와 서브넷 마스크 설정이 제대로 되어 있는지 확인



#### 네트워크 유효범위 파악

- IP와 서브넷 마스크의 AND 연산으로 서브네팅 된 네트워크 주소를 알아낼 수 있음

  ``` 
    103.  9. 32.146 => 01100111.00001001.00100000.10010010
    255.255.255.192 => 11111111.11111111.11111111.11000000
  ---------------------------------------------------------------
                       01100111.00001001.00100000.10000000
  ```

- 이를 통해 네트워크 ID는 103.9.32.128이 되는 것을 알 수 있음

- 각 네트워크 ID에서 첫번째 주소(103.9.32.128)는 Network Address로 쓰이고 마지막 주소(103.9.32.191)는 Broadcast(네트워크 아이디에서 호스트비트를 모두 1로 변경)로 쓰이므로 이들은 호스트에 할당 할 수 없음

- 따라서 유효 IP 범위는 네트워크 주소 + 1 ~ 브로드캐스트 주소 -1 (103.9.32.129 ~ 103.9.32.191) 과 같음



### 네트워크 설계자의 서브네팅

#### 네트워크 설계자가 서브넷마스크에 대해 고려할 점

- 서브넷된 하나의 네트워크에 IP를 몇개나 할당할지
- 서브넷 된 네트워크가 몇개나 필요할 지



#### 네트워크 설계 과정

- 회사에 총 12곳의 지사가 있고, 이 지사들에는 최대 12개의 IP가 필요하며, 현재 가진 네트워크는 103.9.32.0/24 일 때

  - 네트워크는 2진수의 배수로 커지므로 4, 8, 16, 32, 64, 128, 256개 단위로 네트워크를 할당할 수 있음

  - 12개를 수용하는 가장 작은 네트워크는 16개 이므로 16개 짜리 네트워크를 할당

  - 네트워크 주소와 브로드캐스트 주소로 사용할 2개를 제외하면 14개를 사용할 수 있으므로 해당 네트워크는 사용 가능
  - 이후 16개짜리 네트워크 12개를 확보함

- 네트워크 설계 시, 사설 IP 대역을 사용해 충분한 IP 대역을 사용하는 것이 좋음
- 네트워크 안의 서브넷을 나누는 물리적인 장치는 라우터인데, 잘 설계된 네트워크 일 수록 라우터가 관리하는 경로가 적고 관리하기 쉬움



## 공인 IP와 사설 IP

- 공인 IP
  - 인터넷에 접속하기 위한 유일한 식별자
- 사설 ip
  - 인터넷에 연결하지 않고 개인적으로 네트워크를 구성한다면 공인 IP 없이 네트워크 구축 가능
  - NAT 기술(공인 IP로 변경하는 기술)을 사용할 경우 사용 가능 (공유기, 회사 방화벽 등)



###  Bogon IP

- IP 주소 할당 기구 IANA가 여러가지 목적으로 예약해놓아 공인 IP로 할당되지 않는 주소
- 만약 Bogon IP 대역의 주소를 사용한 통신 시도가 있었다면 해킹 목적으로 IP 스푸핑(변조)를 했거나 실수로 할당된 IP를 사용한 경우이므로 필터링 해야 함
