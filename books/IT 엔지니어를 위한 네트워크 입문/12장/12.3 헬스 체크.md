# 헬스 체크
- 로드 벨런서에서 부하 분산을 하는 각 서버의 서비스를 주기적으로 헬스 체크해 정상적인 서브스 쪽으로만 부하 분산, 비정상적인 서버는 서비스 그룹에서 제외해 트래픽을 보내지 않음

## 헬스 체크 방식
### ICMP
- VIP에 연결된 리얼 서버에 대해 ICMP(ping)으로 헬스 체크 수행
- 단순히 서버가 살아 있는지만 확인 가능하여, 잘 사용되는 방법은 아님

### TCP 서비스 포트
- 가장 기본적인 헬스 체크 방법은 로드 벨런서에 설정
- 등록된 포트로 SYN을 보내고, 서버는 SYN ACK를 받으면 ACK 응답, FIN을 보내어 헬스 체크 종료

### TCP 서비스 포트 : Half Open
- 일반 TCP 서비스 포트 확인할 때 3방향 핸드셰이크
- 부하를 줄이거나 정상적 종료 방식보다 빨리 헬스 체크 세션을 끊기 위해 3방향 4방향 핸드셰이크 대신 Half Open(절반 개방) 방식 사용
- SYN을 보내는 것에서 시작하지만, SYN ACK를 받은 이후 RST 신호를 보내고 종료

### HTTP 상태 코드
- 웹 서비스를 할 때, 서비스 포트까지 TCP로 정상적으로 열리지만, 정상적인 응답을 받지 못하는 경우가 있음
- HTTP 상태 코드를 확인하는 방식으로 3방향 핸드셰이크 이후 정상적 상태 코드를 응답하는지 확인

### 콘텐츠 확인(문자열 확인)
- 서버로 콘텐츠를 요청, 응답받은 내용을 확인하여 정상적으로 응답했는지 확인
- 특정 웹페이지를 호출해 사전 지정한 문자열이 해당 웹페이지에 포함되어 있는지 확인하는 기능

## 헬스 체크 주기와 타이머
- 헬스 체크를 관장하는 타이머의 주요 값으로 주기, 응답시간 등이 있음
- 주기 : 로드 밸런서에서 서버로 핼스 체크 패킷을 보내는 주기
- 응답 시간 : 로드 밸런서에서 헬스 체크 패킷을 보내고 응답을 기다리는 시간
- 시도 횟수 : 헬스 체크 실패 시 최대 시도 횟수
- 타임아웃 : 헬스 체크 실패 시 최대 대기 시간
- 서비스 다운 시의 주기 : 서비스 다운시 헬스 체크 주기
